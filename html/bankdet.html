<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../assets/css/bankdet.css">
    <title>Bankdetails</title>
</head>

<body>
    <!-- header -->
    <main>
        <div class="borderbox">
            <img class="label" src="../assets/image/label.png" height="30px" width="30px" alt="img">
            <p class="para">10% Cashback on Greenfarm Axis Bank Card</p>
            <hr>
            <h4>All Other Options</h4>
            <form id="bankdetails">
                <div class="info">
                    <input type="radio" class="payment_option" id="upi" name="rdo" value="upi" >UPI
                    <img class="labelimg" src="../assets/image/google-pay.png" height="50px" width="50px"
                        alt="img"><br><br>
                    <hr>
                    <input type="radio" class="payment_option" id="postpaid" name="rdo" value="wallet">Wallet/Postpaid
                    <img class="labelimg" src="../assets/image/purse.png" height="30px" width="30px" alt="img"><br><br>
                    <hr>
                    <input type="radio" class="payment_option" id="credit" name="rdo" value="debit">Credit/Debit/ATM Card
                    <img class="labelimg" src="../assets/image/credit-card (2).png" height="40px" width="40px"
                        alt="img"><br><br>
                    <hr>
                    <input type="radio" class="payment_option" id="netbanking" name="rdo" value="net_banking" >Net Banking
                    <img class="labelimg" src="../assets/image/cashless-payment.png" height="35px" width="40px"
                        alt="img"><br><br>
                    <hr>
                    <input type="radio" class="payment_option" id="cashondelivery" name="rdo" value="cash_on_delivery" >Cash on Delivery
                    <img class="labelimg" src="../assets/image/cash-payment.png" height="38px" width="40px"
                        alt="img"><br><br>
                </div>
                <hr>
                <!-- image -->
                <div class="img">
                    <img src="../assets/image/original.png" height="60px" width="60px" alt="img"><br>
                    Authentic Products<br>
                    <img src="../assets/image/payment-secured.png" height="60px" width="60px" alt="img"><br>
                    Secure Payments
                </div>
        </div>
        <div class="cancel">
            <button class="but"><a href="buynow.html">Cancel</a></button>
            <button class="but"><a>Place Order</a></button>
        </div>
        </form>
        <!-- button -->


    </main>

    <script>

        let getform = document.getElementById("bankdetails");

        let get_buyerdetails = JSON.parse(localStorage.getItem("buyerdetails")) ?? [];

        getform.addEventListener("submit", function (e) {
            e.preventDefault();
            getData();
        })

        function getData() {

            const inputs = document.querySelectorAll(".input")
            console.log(inputs);
            let payment = ""

            for (let i = 0; i < inputs.length; i++) {
                if (inputs[i].checked === true) {
                    payment = inputs[i]["id"]
                }
            }
            console.log(payment);
            const active_user = JSON.parse(localStorage.getItem("active_user"))
            const buyer = JSON.parse(localStorage.getItem("buyerdetails"))

            buyer.find(function (obj) {
                if (active_user["email"] === obj["email"]) {
                    console.log("why");
                    obj["payment_method"] = payment

                }
            })
            localStorage.setItem("buyerdetails", JSON.stringify(buyer))
            // window.location.href = "orderplaced.html";
        }


        let ondate;
        let objectdate = new Date();
        let month = objectdate.getUTCMonth() + 1;
        let day = objectdate.getUTCDate();
        let year = objectdate.getUTCFullYear();
        ondate = day + "/" + month + "/" + year;
        console.log(ondate);

        // orderid
        let order_id = Date.now();
        console.log(order_id);

        let products = JSON.parse(localStorage.getItem('create_product'));

        let url = window.location.search;  //?name=FreshOrganicTomato
        console.log(url)
        let urls = new URLSearchParams(url)
        console.log(urls)//"name":"FreshOrganicTomato"
        let name = urls.get("name")
        console.log(name)//"FreshOrganicTomato"

 
        let result;
        let product;
        product_details.find(function (e) { //arr=[{0},{1},{2}] ; e={0};e={1}

            if (e["product_name"] == name) {
                product=e;
                return (result = e);
                console.log(e);
            }
            else{
                return (result = 0);
            }
        });
         
        console.log(product);

        let bankdetails = document.getElementById("bankdetails");
        bankdetails.addEventListener("submit", function(e){
         e.preventDefault();


         let payment_option = document.querySelector(
            "payment_option:checked").value;


            let user = JSON.parse(localStorage.getItem("active_user"));
            let order = JSON.parse(localStorage.getItem("order")) ?? [];


            let arr = {}

            arr["image"] = product["iamge"];
             arr["price"] = product["price"];
             arr["titlename"] = product["titlename"];
             arr["product_id"] = product["product_id"];
             arr["order_id"] = order_id;
             arr["order_date"] = newdate;
             arr["payment_option"] = payment_option;


             order.push(arr);
             localStorage.setItem("order",JSON.stringify(order));
             window.location.href = "orderplaced.html";
         




        })

    </script>


</body>

</html>